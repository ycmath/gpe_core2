# pyproject.toml — gpe_core2 (v2-dev)

[build-system]
requires       = ["setuptools>=61.0", "wheel", "setuptools-scm"]
build-backend  = "setuptools.build_meta"

[project]
name           = "gpe-core2"                # 🔄 v1→v2 패키지명 구분
version        = "2.0.0a0"
authors        = [{ name = "YC Math", email = "your-email@example.com" }]
description    = "CGA-optimised Generative Payload Encapsulation core library"
readme         = "README.md"
requires-python = ">=3.10"                  # CUDA 12x wheel은 py310+ 권장
keywords       = ["gpe", "cga", "data-exchange", "gpu", "zerocopy"]
classifiers    = [
  "Development Status :: 3 - Alpha",
  "Intended Audience :: Developers",
  "License :: OSI Approved :: MIT License",
  "Programming Language :: Python :: 3",
  "Programming Language :: Python :: 3.10",
  "Programming Language :: Python :: 3.11",
  "Programming Language :: Python :: 3.12",
]

# ──────────────────────────────
# 런타임 필수 의존성
# ──────────────────────────────
dependencies = [
  "numpy>=1.24",            # CuPy 12x wheel과 호환
  "orjson>=3.9",
  "xxhash>=3.4",
  "redis>=5.0",             # ★ A. Expressway Hash-Lane
  "torch>=2.2; extra == \"gpu\"",  # ★ D. zero-copy (선택)
]

[project.optional-dependencies]
# GPU flavour를 선택식으로 분리
gpu11    = ["cupy-cuda11x>=12.0.0"]
gpu12    = ["cupy-cuda12x>=12.0.0"]
dev      = [
  "pytest>=8",
  "hypothesis>=6.100", 
  "pytest-cov>=5.0",  # ← 추가
  "black>=24.3",
  "ruff>=0.4",
  "isort>=5.13",
  "flake8>=7.0",
  "mypy>=1.10",
  "tqdm>=4.66",
]
all      = ["gpe-core2[gpu12,dev]"]   # one-shot 설치용

[project.urls]
Homepage        = "https://github.com/ycmath/gpe_core2"
"Bug Tracker"   = "https://github.com/ycmath/gpe_core2/issues"
Documentation   = "https://github.com/ycmath/gpe_core2/wiki"

[project.scripts]
gpe = "gpe_core2.cli:main"            # 진입점 모듈 변경

# ──────────────────────────────
# setuptools 구성
# ──────────────────────────────
[tool.setuptools]
packages = [
  "gpe_core2",
  "gpe_core2.encoder",
  "gpe_core2.decoder",
  "gpe_core2.utils",
  "gpe_core2.glassbox",
]

include-package-data = true

[tool.setuptools.package-data]
"gpe_core2.decoder" = ["*.cu", "*.cuh"]   # GPU 커널이 있을 경우

# ──────────────────────────────
# 개발 도구 설정
# ──────────────────────────────
[tool.isort]
profile      = "black"
line_length  = 88

[tool.black]
line-length      = 88
target-version   = ["py310", "py311", "py312"]

[tool.mypy]
python_version         = "3.10"
strict_optional        = true
warn_unused_configs    = true
ignore_missing_imports = true

[[tool.mypy.overrides]]
module = [
  "cupy.*",
  "torch.*",
  "redis.*",
  "orjson.*",
  "xxhash.*",
]
ignore_missing_imports = true
